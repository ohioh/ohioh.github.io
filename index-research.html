<!doctype html>
<!--
Copyright 2020 Google Inc. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sample illustrating the use of Web Bluetooth / Scanning.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
	<title>OHIOH-Research</title>
	<link rel="stylesheet" type="text/css" href="/style/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="/style/style.css">
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900|Roboto:300,300i,400,400i,500,500i,700,700i,900,900i&amp;display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="/fonts/css/fontawesome-all.min.css">
	<link rel="manifest" href="_manifest.json" data-pwa-version="1.0.1">
	<link rel="apple-touch-icon" sizes="180x180" href="/icons/Icon-apple-180.png">
    <title>Web Bluetooth / Scanning Sample</title>
   
    
    
    
    
    <link rel="icon" href="icon.png">
    
    <link rel="stylesheet" href="../styles/main.css">
    
    
  </head>

  <body class="theme-light" data-highlight="OHIOH">


<div id="page">

    <!-- header and footer bar go here-->
    <div class="header header-fixed header-auto-show header-logo-app">
        <a href="index.html" class="header-title">OHIOH Research</a>
        <a href="#" data-back-button class="header-icon header-icon-1"><i class="fas fa-arrow-left"></i></a>
        <a href="#" data-toggle-theme class="header-icon header-icon-2 show-on-theme-dark"><i class="fas fa-sun"></i></a>
        <a href="#" data-toggle-theme class="header-icon header-icon-2 show-on-theme-light"><i class="fas fa-moon"></i></a>
        <a href="#" data-menu="menu-highlights" class="header-icon header-icon-3"><i class="fas fa-brush"></i></a>
    </div>
    <div id="footer-bar" class="footer-bar-5">
        <a href="index-features.html"><i data-feather="heart" data-feather-line="1" data-feather-size="21"
                data-feather-color="ohioh" data-feather-bg="red2-fade-light"></i><span>Features</span></a>
        <a href="index-research.html"><i data-feather="bluetooth" data-feather-line="1" data-feather-size="21"
                data-feather-color="ohioh" data-feather-bg="green1-fade-light"></i><span>Research</span></a>
        <a href="index.html" class="active-nav"><i data-feather="home" data-feather-line="1" data-feather-size="21"
                data-feather-color="ohioh" data-feather-bg="blue2-fade-light"></i><span>Home</span></a>
        <a href="index-QR.html"><i data-feather="camera" data-feather-line="1" data-feather-size="21"
                data-feather-color="ohioh" data-feather-bg="brown1-fade-light"></i><span>QR-Infos</span></a>
        <a href="index-settings.html"><i data-feather="settings" data-feather-line="1" data-feather-size="21"
                data-feather-color="ohioh" data-feather-bg="gray2-fade-light"></i><span>Settings</span></a>
    </div>

<div class="page-content">

  <div class="page-title page-title-small">
            <h2><a href="#" data-back-button><i class="fa fa-arrow-left"></i></a>Research</h2>
            <a href="#" data-menu="menu-main" class="bg-fade-gray1-dark shadow-xl preload-img" data-src=""></a>
        </div>
        <div class="card header-card shape-rounded" data-card-height="150">
            <div class="card-overlay bg-highlight opacity-95"></div>
            <div class="card-overlay dark-mode-tint"></div>
            <div class="card-bg preload-img" data-src="images/pictures/20.png"></div>
        </div>

        <div class="card card-style">
            <div class="content">
                Research Fotos... no reading: See us in action
            </div>
        </div>


        <a href="index-features.html" data-card-height="120" class="card card-style mb-3">
            <div class="card-center pl-3 ml-2">
                <i data-feather="camera"
                   data-feather-line="1"
                   data-feather-size="50"
                   data-feather-color="blue2-dark"
                   data-feather-bg="blue2-fade-light">
                </i>
            </div>
            <div class="card-center pl-5 ml-5">
                <h4 class="pl-2">Galleries</h4>
                <p class="pl-2 mt-n2 font-12 color-highlight mb-0">Images  from OHIOH-Research</p>
            </div>
            <div class="card-center opacity-30">
                <i class="fa fa-arrow-right opacity-50 float-right color-theme pr-3"></i>
            </div>
        </a>

        <a href="index-features.html" data-card-height="120" class="card card-style mb-3">
            <div class="card-center pl-3 ml-2">
                <i data-feather="image"
                   data-feather-line="1"
                   data-feather-size="50"
                   data-feather-color="green1-dark"
                   data-feather-bg="green1-fade-light">
                </i>
            </div>
            <div class="card-center pl-5 ml-5">
                <h4 class="pl-2">Research-Projects</h4>
                <p class="pl-2 mt-n2 font-12 color-highlight mb-0">To the projects</p>
            </div>
            <div class="card-center opacity-30">
                <i class="fa fa-arrow-right opacity-50 float-right color-theme pr-3"></i>
            </div>
        </a>

        <a href="index-features.html" data-card-height="120" class="card card-style">
            <div class="card-center pl-3 ml-2">
                <i data-feather="zap"
                   data-feather-line="1"
                   data-feather-size="50"
                   data-feather-color="yellow1-dark"
                   data-feather-bg="yellow1-fade-light">
                </i>
            </div>
            <div class="card-center pl-5 ml-5">
                <h4 class="pl-2">social media</h4>
                <p class="pl-2 mt-n2 font-12 color-highlight mb-0">Instagram, Facebook, Twitter && Co</p>
            </div>
            <div class="card-center opacity-30">
                <i class="fa fa-arrow-right opacity-50 float-right color-theme pr-3"></i>
            </div>
        </a>
<p>Note: Scanning is still under development. You must be using Chrome 79+
with the <code>chrome://flags/#enable-experimental-web-platform-features</code>
flag enabled.</p>

<form>
  
  <button>Scan for Bluetooth Advertisements</button>
</form>



<h3>Live Output</h3>
<div id="output" class="output">
  <div id="content"></div>
  <div id="status"></div>
  <pre id="log"></pre>
</div>

	  <div class="footer" data-menu-load="menu-footer.html"></div>
    </div>
	  <div id="menu-share"
         class="menu menu-box-bottom menu-box-detached rounded-m"
         data-menu-load="menu-share.html"
         data-menu-height="420"
         data-menu-effect="menu-over">
    </div>

    <div id="menu-highlights"
         class="menu menu-box-bottom menu-box-detached rounded-m"
         data-menu-load="menu-colors.html"
         data-menu-height="510"
         data-menu-effect="menu-over">
    </div>

    <div id="menu-main"
         class="menu menu-box-right menu-box-detached rounded-m"
         data-menu-width="260"
         data-menu-load="menu-main.html"
         data-menu-active="nav-media"
         data-menu-effect="menu-over">
    </div>
	
</div>
<script>

   // Add a global error event listener early on in the page load, to help ensure that browsers
      // which don't support specific functionality still end up displaying a meaningful message.
      window.addEventListener('error', function(error) {
        if (ChromeSamples && ChromeSamples.setStatus) {
          console.error(error);
          ChromeSamples.setStatus(error.message + ' (Your browser may not support this feature.)');
          error.preventDefault();
        }
      });
      
  if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }

  window.addEventListener('DOMContentLoaded', function() {
    const searchParams = new URL(location).searchParams;
    const inputs = Array.from(document.querySelectorAll('input[id]'));

    inputs.forEach(input => {
      if (searchParams.has(input.id)) {
        if (input.type == 'checkbox') {
          input.checked = searchParams.get(input.id);
        } else {
          input.value = searchParams.get(input.id);
          input.blur();
        }
      }
      if (input.type == 'checkbox') {
        input.addEventListener('change', function(event) {
          const newSearchParams = new URL(location).searchParams;
          if (event.target.checked) {
            newSearchParams.set(input.id, event.target.checked);
          } else {
            newSearchParams.delete(input.id);
          }
          history.replaceState({}, '', Array.from(newSearchParams).length ?
              location.pathname + '?' + newSearchParams : location.pathname);
        });
      } else {
        input.addEventListener('input', function(event) {
          const newSearchParams = new URL(location).searchParams;
          if (event.target.value) {
            newSearchParams.set(input.id, event.target.value);
          } else {
            newSearchParams.delete(input.id);
          }
          history.replaceState({}, '', Array.from(newSearchParams).length ?
              location.pathname + '?' + newSearchParams : location.pathname);
        });
      }
    });
  });

    var ChromeSamples = {
    log: function() {
      var line = Array.prototype.slice.call(arguments).map(function(argument) {
        return typeof argument === 'string' ? argument : JSON.stringify(argument);
      }).join(' ');

      document.querySelector('#log').textContent += line + '\n';
    },

    clearLog: function() {
      document.querySelector('#log').textContent = '';
    },

    setStatus: function(status) {
      document.querySelector('#status').textContent = status;
    },

    setContent: function(newContent) {
      var content = document.querySelector('#content');
      while(content.hasChildNodes()) {
        content.removeChild(content.lastChild);
      }
      content.appendChild(newContent);
    }
  };

  if (/Chrome\/(\d+\.\d+.\d+.\d+)/.test(navigator.userAgent)){
    // Let's log a warning if the sample is not supposed to execute on this
    // version of Chrome.
    if (79 > parseInt(RegExp.$1)) {
      ChromeSamples.setStatus('Warning! Keep in mind this sample has been tested with Chrome ' + 79 + '.');
    }
  }

      
      async function onButtonClick() {
	      
	      var flag = 1;
  scanon();
function scanon() {
  setTimeout(function(){
    log('Scan off');
  flag=0;
  scanoff();
  
  }, 5000);
}

function scanoff() {
  setTimeout(function(){
  log('Scan start');
  
  flag = 1;
  scanon();
  
  }, 3000);
}
  let options = {};
  
    options.acceptAllAdvertisements = true;
  

  try {
    log('Requesting Bluetooth Scan with options: ' + JSON.stringify(options));
    const scan = await navigator.bluetooth.requestLEScan(options);

    log('Scan started with:');
    log(' acceptAllAdvertisements: ' + scan.acceptAllAdvertisements);
    log(' active: ' + scan.active);
    log(' keepRepeatedDevices: ' + scan.keepRepeatedDevices);
    log(' filters: ' + JSON.stringify(scan.filters));
var devices = [];
    navigator.bluetooth.addEventListener('advertisementreceived', event => {

        
 
        if ( event.device.name != null && flag == 1)
      {
	    
	      // log('Advertisement received.');
        function checkAdult(device) {
        //  log('||' + typeof device+'|'+ typeof event.uuids+"||");
            return device+" " == event.uuids+" ";
          }
          if(devices.find(checkAdult))
{
//log("hhhhhhhhhhhhh");
}
      
else{
//log("xxxxxxx");
   devices.push(event.uuids);
    if(1)
        {
        


        
         
          VALUE = JSON.stringify({
          
          "email": "Ratul@gmail.com",
      "uuid": event.uuids+" ",
"rssi": event.rssi+" ",
"devicename": event.device.name,
            "txpower" : event.txPower+" "
          });
    console.log(VALUE);

    const myHeaders = new Headers();
    myHeaders.append('Content-Type', 'application/json');

    fetch('https://ohioh.app:8442/api/users', {
        method: 'POST',
        headers: myHeaders,
        mode: 'cors',
        cache: 'default',
        body: VALUE
    })
    .then(data => data.json())
    .then(data =>  { console.log(data)
                  // window.location.href = "https://gui--festive-ardinghelli-674e56.netlify.app/index.html";
                 //   alert("Congrats you are successfully logged in");
                   }) 
    .catch((err) => {
        console.error(err);
    })
          
         log('Advertisement received.');
      log('  Device Name: ' +'<i>'+ event.device.name+'</i>');
      log('  Device ID: ' + event.device.id);
      log('  RSSI: ' + event.rssi);
      log('  TX Power: '+ + event.txPower);
          
      log('  UUIDs: '+'<i>' + event.uuids+'</i>');
           log('  Time: '+'<i>'  +  new Date(new Date().getTime() + 4*60*60*1000).toLocaleTimeString()+'</i>');
           
      event.manufacturerData.forEach((valueDataView, key) => {
        logDataView('Manufacturer', key, valueDataView);
      });
      event.serviceData.forEach((valueDataView, key) => {
        logDataView('Service', key, valueDataView);
      });
     
      }
}
    }
     
    });

    setTimeout(stopScan, 10000);
    function stopScan() {
      log('Stopping scan...');
      scan.stop();
     
      log('Stopped.  scan.active = ' + scan.active);
	 //    scan = await navigator.bluetooth.requestLEScan(options);
	     log('Stopped.  scan.active = ' + scan.active);
    }
  } catch(error)  {
    log('Argh! ' + error);
  }
}

/* Utils */

const logDataView = (labelOfDataSource, key, valueDataView) => {
  const hexString = [...new Uint8Array(valueDataView.buffer)].map(b => {
    return b.toString(16).padStart(2, '0');
  }).join(' ');
  const textDecoder = new TextDecoder('ascii');
  const asciiString = textDecoder.decode(valueDataView.buffer);
  log(`  ${labelOfDataSource} Data: ` + key +
      '\n    (Hex) ' + hexString +
      '\n    (ASCII) ' + asciiString);
};

  document.querySelector('form').addEventListener('submit', function(event) {
    event.stopPropagation();
    event.preventDefault();

    if (isWebBluetoothEnabled()) {
      ChromeSamples.clearLog();
      onButtonClick();
    }
  });

  log = ChromeSamples.log;

  function isWebBluetoothEnabled() {
    if (navigator.bluetooth) {
      return true;
    } else {
      ChromeSamples.setStatus('Web Bluetooth API is not available.\n' +
          'Please make sure the "Experimental Web Platform features" flag is enabled.');
      return false;
    }
  }

      /* jshint ignore:start */
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-53563471-1', 'auto');
      ga('send', 'pageview');
      /* jshint ignore:end */
    </script>
	  <script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/custom.js"></script>
  </body>
</html>
